<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Riichi Documentation</title>
	</head>
	<body>
		<style type="text/css">
			h1 {text-align: center;}
			#content {white-space:pre-wrap;}
		</style>
		<h1>Опис Riichi ( kohana framework, goDB, jQuery ).</h1>
		<ul>
			<li>
				<a href="#a_1">Структура файлів</a>
				<ul>
					<li>
						<a href="#a_1_1">"/aplication/config/"</a>
					<li>
						<a href="#a_1_2">"/aplication/classes/controller/"</a>
					<li>
						<a href="#a_1_3">"/aplication/model/"</a>
					<li>
						<a href="#a_1_4">"/aplication/functions/"</a>
					<li>
						<a href="#a_1_5">"/aplication/views/"</a>
				</ul>
			<li>
				<a href="#a_2">Структура і порядок виклику класів. Серверна частина(PHP).</a>
				<ul>
					<li>
						<a href="#a_2_1">Темплейт</a>
					<li>
						<a href="#a_2_2">Контроллери</a>
						<ul>
							<li>
								<a href="#a_2_2_1">"home"</a>
							<li>
								<a href="#a_2_2_1">"auth"</a>
							<li>
								<a href="#a_2_2_1">"forget_password"</a>
							<li>
								<a href="#a_2_2_1">"games"</a>
							<li>
								<a href="#a_2_2_1">"index"</a>
						</ul>
					<li>
						<a href="#a_2_3">Моделі</a>
				</ul>
			<li>
				<a href="#a_3">Javascript фреймворк. Клієнтська частина (Ajax)</a>
				<ul>
					<li>
						<a href="#a_3_1">Базові методи класу "core"</a>
				</ul>
			<li>
				<a href="#a_4">Багатомовність.</a>
		</ul>
<div id="content">
	<a name="a_1"/><h2>1. Структура файлів.</h2>
	В Riichi існують наступні директорії:
		
		<a name="a_1_1"/><h3>1.1) "/aplication/config/"</h3> - це директорія в якій знаходяться основні налаштування такі як доступ до БД і т.п.
		
		<a name="a_1_2"/><h3>1.2) "/aplication/classes/controller/"</h3> - це директорія в якій знаходяться основні php файли фреймворку.
		
		<a name="a_1_3"/><h3>1.3) "/aplication/classes/model/"</h3> - це директорія в якій знаходяться php файли основне признаення яких - робота з БД.
		
		<a name="a_1_4"/><h3>1.4) "/aplication/functions/"</h3> - це директорія в якій знаходяться основні багаторазові функції.
		
		<a name="a_1_5"/><h3>1.5) "/aplication/views/"</h3> - це веб директорія в якій знаходяться результати виконання методів котроллерів
		
	<a name="a_2"/><h2>2.Структура і порядок виклику класів. Серверна частина(PHP).</h2>
	
		Всі запити будуть мати наступний вигляд :
			
			http://somehost.com
			http://somehost.com/{controller}
			http://somehost.com/{controller}/{action}
			http://somehost.com/{controller}/{action}/{parameter1}
			http://somehost.com/{controller}/{action}/{parameter1}/../{parameterN}
			http://somehost.com/{controller}/{action}?{parameters}
		
		<a name="a_2_1"/><h3>2.1) Клас "/aplication/classes/controller/template/generic.php" </h3>
			
			Темплейт реалізує виклик методів які можуть бути доступні на сайті практично в любий момент гри
			Методи:
				- changeLanguage "вибір мови"
				- changeColors "вибір фону гри"
				- changePvPRules "вибір правил PvP: з чітами / без; IRA-IRA / EMA / Hongkong / ... "
			
		<a name="a_2_2"/><h3>2.2) Класи "/aplication/classes/controller/{controller}.php"</h3>
			
			Контролер відповідає за те яким чином формувати view( інтерфейс користувача ) і які дані отримувати для відображення або навпаки передавати для збереження
			Методи:
			- before.php - базовий метод, який виконується щоразу перед виконанням всіх інших методів
			- after.php - базовий метод, який виконується щоразу після виконанням всіх інших методів
			- index.php - стартовий метод контроллера
		
		<a name="a_2_2_1"/><h3>2.2.1) контроллер "home"</h3> - базова сторінка сайту
			Методи:
				- залогуватись
				- зареєструватись
				- забув пароль
				- переглянути партію (пошук і вибірка партій по імені гравця, даті, рівню гравців і т.п.)
		
		<a name="a_2_2_2"/><h3>2.2.2) контроллер "auth"</h3> - сторінка реєстрації
			Методи:
				- зареєструватись
		
		<a name="a_2_2_3"/><h3>2.2.3) контроллер "forget_password"</h3> - сторінка відновлення паролю
			Методи:
				- надіслати лист з новим паролем на емейл
		
		<a name="a_2_2_4"/><h3>2.2.4) контроллер "games"</h3> - сторінка пошуку і відображення партій
			Методи:
				- сортувати за ...
				- фільтрувати за ...
				- показати хід партії
		
		<a name="a_2_2_5"/><h3>2.2.5) контроллер "index"</h3> - головна сторінка. Тут відображається головне меню гри. Всі контроллери окрім чотирьох описаних вище стосуються виключно залогованого гравця.
			Методи:
				- Вилогуватись
				- (решта методів викликають одноіменні контроллери)
			
			
		
		<a name="a_2_3"/><h3>2.3) Класи "/aplication/classes/model/{model}.php"</h3>
			
			Модель відповідає за те яким чином обмінюватись даними з БД.
			Як правило, ім’я моделі співпадає з ім’ям таблиці в БД з якою ця модель співпрацює.
			
	<a name="a_3"/><h2>3) Javascript фреймворк. Клієнтська частина (jQuery)</h2>
	
		Щоразу підключаються 2 js файли 
		&lt;script language="JavaScript" type="text/javascript" src="/js/jquery.js"&gt;&lt;/script&gt;
		&lt;script language="JavaScript" type="text/javascript" src="/js/core.js"&gt;&lt;/script&gt;
		&lt;script language="JavaScript" type="text/javascript" src="/js/index.js"&gt;&lt;/script&gt;
		
		Клас "core" створюється відразу в файлі "/js/core.js".
		В "core" відбувається :
			- перевірка чи користувач уже не залогований
			- автозавантаження подій по часу (наприклад, чи вже наступив День Народження користувача і якщо наступив - система повинна надіслати йому привітальний лист і подарунок у вигляді тимчасових бонусів у грі. День Народження може наступити навіть в процесі гри.)
			- і інші базові речі
		
		<a name="a_3_1"/><h3>3.1) Базові методи класу "core"</h3>
		
			Доопрацьовується

	<a name="a_4"/><h2>4) Багатомовність.</h2>
	
		Для виконання багатомовності можна використовувати вбудований клас "i18n", який отримує текстові значення з файлів типу "/application/i18n/{languageName}.php"
		Для того щоб відобразити багатомовну стрічку, необхідньо у {action}.php файлі використати наприклад 
			__('Hello World')
		Потім в {languageName}.php файлі добавити
			return array(
					...,
					
					'Hello World' => 'Вітаю тебе, світ',
					
					...
			);
		
		
		
		Або використовувати власний клас "/application/functions/view.php" який може зчитувати текстові значення і з *.xml файлів, *.php чи з БД. Ще одною перевагою даного класу повинна бути рекурсивність
		Для того щоб відобразити багатомовну стрічку, необхідньо у {action}.php файлі використати наприклад 
			{%CITY%}.
		Потім в БД в таблиці textContent добавити рядок, де поле tagDescriptor встановити в 'CITY' і відповідні поля "EN","UA" ...
		Тоді при відображення класс view_core замінить  "{%CITY%}" на відповідну стрічку з "EN","UA" ...
		
		Також передбачена вкладена заміна тексту.
		Наприклад, після перекладу "{%CITY%}" ми отримали результат
			"{%city%} було засновано {stolittya} століття".
		
		Тоді для того щоб відбулася заміна "{stolittya}" потрібно в контроллері виконати наступне
			$this-&gt;view-&gt;set_local_var('stolittya','IV');
		
		Тоді отриманий результат буде
			"{%city%} було засновано IV століття".
		
		Тоді вже відбувається пошук і заміна "{%city%}" і отриманий результат буде
			"Місто було засновано IV століття".
		
		Можливо, вдасться поєднати обидва класи в єдиний.
</div>
	</body>
</html>